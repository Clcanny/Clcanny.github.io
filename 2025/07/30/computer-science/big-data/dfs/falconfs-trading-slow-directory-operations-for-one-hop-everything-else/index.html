

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="JunBin">
  <meta name="keywords" content="">
  
    <meta name="description" content="Core Idea FalconFS represents a paradigm shift in distributed file system design by making deliberate tradeoffs optimized for AI workloads. Unlike traditional distributed file systems that aim for bal">
<meta property="og:type" content="article">
<meta property="og:title" content="falconfs-trading-slow-directory-operations-for-one-hop-everything-else">
<meta property="og:url" content="https://clcanny.github.io/2025/07/30/computer-science/big-data/dfs/falconfs-trading-slow-directory-operations-for-one-hop-everything-else/index.html">
<meta property="og:site_name" content="On The Road">
<meta property="og:description" content="Core Idea FalconFS represents a paradigm shift in distributed file system design by making deliberate tradeoffs optimized for AI workloads. Unlike traditional distributed file systems that aim for bal">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://junbin-hexo-img.oss-cn-beijing.aliyuncs.com/falconfs-trading-slow-directory-operations-for-one-hop-everything-else/figure-5-architecture-of-falconfs.png">
<meta property="og:image" content="https://junbin-hexo-img.oss-cn-beijing.aliyuncs.com/falconfs-trading-slow-directory-operations-for-one-hop-everything-else/table-1-scheme-of-falconfs-s-metadata.png">
<meta property="article:published_time" content="2025-07-30T15:49:00.000Z">
<meta property="article:modified_time" content="2025-07-30T17:14:04.052Z">
<meta property="article:author" content="JunBin">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://junbin-hexo-img.oss-cn-beijing.aliyuncs.com/falconfs-trading-slow-directory-operations-for-one-hop-everything-else/figure-5-architecture-of-falconfs.png">
  
  
  
  <title>falconfs-trading-slow-directory-operations-for-one-hop-everything-else - On The Road</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"clcanny.github.io","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.0.0-rc1"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="falconfs-trading-slow-directory-operations-for-one-hop-everything-else"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-07-30 23:49" pubdate>
          2025年7月30日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          4.4k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          37 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">falconfs-trading-slow-directory-operations-for-one-hop-everything-else</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="core-idea">Core Idea</h2>
<p>FalconFS represents a paradigm shift in distributed file system design by making deliberate tradeoffs optimized for AI workloads. Unlike traditional distributed file systems that aim for balanced performance across all operations, FalconFS strategically sacrifices scalability and performance on complex write requests to dramatically boost scalability and performance on read requests and simple write requests - the dominant operations in deep learning pipelines.</p>
<h2 id="introduction-the-falconfs-architecture">Introduction: The FalconFS Architecture</h2>
<p>FalconFS consists of three main components:</p>
<ul>
<li>MNodes: Handle metadata</li>
<li>File Stores: Handle data storage</li>
<li>Clients</li>
</ul>
<p>The key innovation lies in how metadata is partitioned. Both dentries and inodes are assigned to <strong>owner MNodes</strong> based on filename hashing - without including parent directory IDs. Dentries are replicated across all MNodes through lazy replication. This design allows any MNode to resolve full paths locally.</p>
<figure>
<img src="https://junbin-hexo-img.oss-cn-beijing.aliyuncs.com/falconfs-trading-slow-directory-operations-for-one-hop-everything-else/figure-5-architecture-of-falconfs.png" srcset="/img/loading.gif" lazyload alt="" /><figcaption>Figure 5: Architecture of FalconFS</figcaption>
</figure>
<figure>
<img src="https://junbin-hexo-img.oss-cn-beijing.aliyuncs.com/falconfs-trading-slow-directory-operations-for-one-hop-everything-else/table-1-scheme-of-falconfs-s-metadata.png" srcset="/img/loading.gif" lazyload alt="" /><figcaption>Table 1: Scheme of FalconFS's metadata</figcaption>
</figure>
<h2 id="boosting-read-performance-and-scalability">Boosting Read Performance and Scalability</h2>
<p>FalconFS achieves exceptional read performance through its one-hop architecture.</p>
<h3 id="performance">Performance</h3>
<p>When a client needs to access <code>/data1/image.jpg</code>, it hashes the filename <code>image.jpg</code> to determine the target MNode. That MNode can complete the entire operation locally because:</p>
<ul>
<li>It owns the inode for <code>image.jpg</code>.</li>
<li>It has replicated dentries for all ancestor directories (<code>/</code>, <code>data1</code>).</li>
</ul>
<p>This eliminates the request amplification problem where traditional DFS clients must look up each path component separately, potentially requiring multiple network round-trips.</p>
<h3 id="scalability">Scalability</h3>
<p>The filename-based partitioning ensures that as long as filenames are reasonably distributed (which is typical in AI datasets with millions of unique files), requests naturally load-balance across MNodes. Adding more MNodes directly increases the system's capacity to handle concurrent requests, providing near-linear scalability for read operations.</p>
<h2 id="maintaining-correctness-guarantees">Maintaining Correctness Guarantees</h2>
<p>FalconFS ensures correctness through careful design of its concurrency control mechanisms, providing serializability, linearizability, and atomicity guarantees.</p>
<h3 id="serializability-and-linearizability">Serializability and Linearizability</h3>
<p>FalconFS employs a sophisticated two-level locking protocol based on two-phase locking:</p>
<ul>
<li><strong>Coordinator-level implicit locks</strong>: MSI-style (Modified-Shared-Invalid) coherence protocol</li>
<li><strong>MNode-level explicit locks</strong>: Traditional in-memory locks (e.g., <code>std::shared_lock</code>)</li>
</ul>
<p>The locking order is strictly enforced from root to leaf to prevent deadlocks. For an operation on <code>/data1/image.jpg</code>, the process is as follows: First, the coordinator locks <code>/</code>, <code>data1</code> and <code>image.jpg</code>. Then the MNode locks <code>/</code>, <code>data1</code> and <code>image.jpg</code>. Locks are always released in the reverse order once the operation is complete.</p>
<p>The 2PL protocol guarantees <strong>serializability</strong> and <strong>linearizability</strong>. Linearizability is guaranteed because:</p>
<ul>
<li>The linearization point for each request is clearly defined as the moment it acquires its final lock, either at the MNode or the coordinator.</li>
<li>TThis lock acquisition always occurs within the request's real-time bounds - after the client initiates the operation and before any response is returned.</li>
<li>The 2PL protocol enforces a consistent ordering of conflicting operations. Once a request acquires its locks, no conflicting request can proceed until those locks are released. This ensures a globally consistent total order that respects the partial orderings of conflicting requests.</li>
</ul>
<h3 id="atomicity">Atomicity</h3>
<p>FalconFS handles atomicity differently based on operation complexity:</p>
<ul>
<li>Inode Creation: These operations only modify a single inode and dentry on the same MNode. The owning MNode handles atomicity internally through local transactions, without coordination overhead.</li>
<li>Other Write Requests: Operations requiring atomicity across multiple MNodes are coordinated via a centralized coordinator using the 2PC protocol.</li>
</ul>
<h2 id="msi-protocol-for-dentry-management">MSI Protocol for Dentry Management</h2>
<p>To achieve one-hop processing, clients do not request the coordinator to explicitly take locks. Instead, coordinator-level locks are implemented using a memory coherence protocol - similar to the MSI model.</p>
<ul>
<li>Normally, the owner MNode shares or replicates its dentry with other MNodes. The dentry is in the <strong>S (Shared)</strong> state, meaning all MNodes can read it, but no modifications (even by the owner) are allowed.</li>
<li>When the owner MNode needs to modify the dentry (e.g., for removal, permission changes, or renaming), the coordinator revokes all S states from other MNodes, transitions them to <strong>I (Invalid)</strong>, and grants <strong>M (Modified)</strong> state to the owner.</li>
</ul>
<p>Once all MNode-level locks are acquired, the MNode must verify that all cached dentry states remain valid. Additionally, the MNode blocks any invalidation requests from the coordinator until the locks are released.</p>
<p>Since there is no explicit acquisition of coordinator-level locks by the client, the locking mechanism is referred to as implicit locks. This design leverages the coherence protocol to ensure consistency and eliminate the need for explicit lock management at the coordinator level.</p>
<h2 id="reference">Reference</h2>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Computer-Science/" class="category-chain-item">Computer Science</a>
  
  
    <span>></span>
    
  <a href="/categories/Computer-Science/Big-Data/" class="category-chain-item">Big Data</a>
  
  
    <span>></span>
    
  <a href="/categories/Computer-Science/Big-Data/DFS/" class="category-chain-item">DFS</a>
  
  

  

  

      </span>
    
  
</span>

    </div>
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>falconfs-trading-slow-directory-operations-for-one-hop-everything-else</div>
      <div>https://clcanny.github.io/2025/07/30/computer-science/big-data/dfs/falconfs-trading-slow-directory-operations-for-one-hop-everything-else/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>JunBin</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年7月30日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/07/31/computer-science/big-data/dfs/understanding-workloads-to-schedule-kvcache-a-methodological-approach/" title="Understanding Workloads to Schedule KVCache - A Methodological Approach">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Understanding Workloads to Schedule KVCache - A Methodological Approach</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/10/26/computer-science/serializability/mvocc-vs-svocc-a-comprehensive-guide-to-optimistic-concurrency-control/" title="MVOCC vs. SVOCC: A Comprehensive Guide to Optimistic Concurrency Control">
                        <span class="hidden-mobile">MVOCC vs. SVOCC: A Comprehensive Guide to Optimistic Concurrency Control</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  



  <script>
  Fluid.utils.createScript('https://lib.baomitu.com/mermaid/8.14.0/mermaid.min.js', function() {
    mermaid.initialize({"theme":"default"});

    Fluid.events.registerRefreshCallback(function() {
      if ('mermaid' in window) {
        mermaid.init();
      }
    });
  });
</script>






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
